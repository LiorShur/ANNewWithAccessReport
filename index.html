<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Access Nature - Making outdoor spaces accessible for everyone">
  <title>Access Nature - Making Trails Accessible</title>
  
  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üå≤</text></svg>">
  
  <!-- External CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css">
  
  <!-- Design System -->
  <link rel="stylesheet" href="access-nature-design-system.css">
  
  <style>
    /* ==========================================
       INDEX PAGE STYLES - CLEANED & CONSOLIDATED
       ========================================== */
    
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding-top: 64px;
    }

    /* Hero Section */
    .hero-section {
      padding: var(--space-3xl) var(--space-xl);
      text-align: center;
      color: white;
    }

    .hero-content {
      position: relative;
      z-index: 1;
      max-width: 800px;
      margin: 0 auto;
    }

    .hero-title {
      font-size: var(--font-size-5xl);
      font-weight: 700;
      margin-bottom: var(--space-lg);
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .hero-subtitle {
      font-size: var(--font-size-xl);
      opacity: 0.95;
      margin-bottom: var(--space-2xl);
    }

    .auth-status-landing {
      margin-top: var(--space-2xl);
      display: flex;
      justify-content: center;
      gap: var(--space-md);
    }

    /* Main Navigation Cards */
    .main-navigation {
      background: white;
      border-radius: var(--radius-xl) var(--radius-xl) 0 0;
      padding: var(--space-3xl) var(--space-xl);
    }

    .nav-container {
      max-width: var(--max-width-xl);
      margin: 0 auto;
      display: grid;
      gap: var(--space-2xl);
    }

    .nav-card {
      background: white;
      border-radius: var(--radius-lg);
      padding: var(--space-2xl);
      box-shadow: var(--shadow-lg);
      transition: all var(--transition-base);
      cursor: pointer;
    }

    .nav-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-xl);
    }

    .nav-card-icon { font-size: 3rem; margin-bottom: var(--space-lg); }

    .nav-card h2, .nav-card h3 {
      font-size: var(--font-size-2xl);
      margin-bottom: var(--space-md);
      color: var(--text-color);
    }

    .nav-card p, .nav-card-description {
      color: var(--text-secondary);
      line-height: 1.6;
      margin-bottom: var(--space-lg);
    }

    .nav-card-features, .nav-card-footer {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-sm);
      margin-bottom: var(--space-lg);
    }

    .feature-tag, .nav-card-badge {
      display: inline-block;
      background: var(--bg-secondary);
      padding: var(--space-xs) var(--space-md);
      border-radius: var(--radius-full);
      font-size: var(--font-size-sm);
      color: var(--text-secondary);
    }

    .quick-search { display: flex; gap: var(--space-sm); margin-top: var(--space-lg); }
    .quick-search input { flex: 1; }

    .tracker-stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: var(--space-md);
      margin-top: var(--space-lg);
    }

    .stat-item {
      text-align: center;
      padding: var(--space-md);
      background: var(--bg-secondary);
      border-radius: var(--radius-md);
    }

    .stat-number {
      display: block;
      font-size: var(--font-size-2xl);
      font-weight: 700;
      color: var(--primary-color);
      margin-bottom: var(--space-xs);
    }

    .stat-label { font-size: var(--font-size-sm); color: var(--text-secondary); }

    /* Community Section */
    .community-section {
      background: var(--bg-secondary);
      padding: var(--space-3xl) var(--space-xl);
    }

    .community-container { max-width: var(--max-width-xl); margin: 0 auto; text-align: center; }
    .community-container h3 { font-size: var(--font-size-3xl); margin-bottom: var(--space-2xl); }

    .community-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--space-xl);
    }

    .community-stat { text-align: center; }

    .stat-big {
      display: block;
      font-size: var(--font-size-5xl);
      font-weight: 700;
      color: var(--primary-color);
      margin-bottom: var(--space-sm);
    }

    .stat-desc { font-size: var(--font-size-base); color: var(--text-secondary); }

    /* Featured Section */
    .featured-section { background: white; padding: var(--space-3xl) var(--space-xl); }
    .featured-container { max-width: var(--max-width-xl); margin: 0 auto; }
    .featured-container h3 { font-size: var(--font-size-3xl); text-align: center; margin-bottom: var(--space-2xl); }

    .featured-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: var(--space-xl);
      margin-bottom: var(--space-2xl);
    }

    .load-more-btn { display: block; margin: 0 auto; }

    /* Footer */
    .footer-section { background: var(--text-color); color: white; padding: var(--space-3xl) var(--space-xl); }
    .footer-container { max-width: var(--max-width-xl); margin: 0 auto; }

    .footer-content {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--space-2xl);
      margin-bottom: var(--space-2xl);
    }

    .footer-brand h4 { color: white; margin-bottom: var(--space-md); }
    .footer-brand p { color: rgba(255,255,255,0.7); }
    .footer-links { display: flex; flex-direction: column; gap: var(--space-sm); }
    .footer-links a { color: rgba(255,255,255,0.7); text-decoration: none; transition: color var(--transition-fast); }
    .footer-links a:hover { color: white; }

    .footer-bottom {
      text-align: center;
      padding-top: var(--space-xl);
      border-top: 1px solid rgba(255,255,255,0.1);
      color: rgba(255,255,255,0.7);
    }

    /* ===========================================
       TRAIL BROWSER MODAL - FIXED
       =========================================== */
    #trailBrowserModal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.75);
      z-index: 999999;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    #trailBrowserModal.hidden { display: none !important; }

    #trailBrowserModal .modal {
      background: white;
      border-radius: 16px;
      max-width: 900px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      padding: 2rem;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }

    #trailBrowserModal .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    #trailBrowserModal .modal-close {
      background: none;
      border: none;
      font-size: 2rem;
      cursor: pointer;
      color: #666;
      line-height: 1;
    }

    #trailBrowserModal .modal-close:hover { color: #333; }

    .filter-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 1rem; }

    #trailResults { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; max-height: 50vh; overflow-y: auto; }

    /* Mobile Responsive */
    @media (max-width: 768px) {
      .hero-title { font-size: var(--font-size-4xl); }
      .hero-subtitle { font-size: var(--font-size-lg); }
      .nav-card h2 { font-size: var(--font-size-xl); }
      .community-stats { grid-template-columns: repeat(2, 1fr); }
      .featured-grid { grid-template-columns: 1fr; }
      .filter-grid { grid-template-columns: 1fr; }
      #trailResults { grid-template-columns: 1fr; }

      .menu-toggle { display: flex !important; visibility: visible !important; opacity: 1 !important; z-index: 100000 !important; }

      .nav-menu {
        position: fixed !important;
        top: 64px !important; left: 0 !important; right: 0 !important; bottom: 0 !important;
        background: white !important;
        z-index: 99999 !important;
        flex-direction: column !important;
        padding: 1rem !important;
        transform: translateX(100%) !important;
        opacity: 0 !important;
        transition: all 0.3s ease !important;
        pointer-events: none !important;
        overflow-y: auto !important;
      }

      .nav-menu.active { transform: translateX(0) !important; opacity: 1 !important; pointer-events: auto !important; }
      .nav-menu .nav-link { display: flex !important; padding: 1rem !important; color: #1a1a1a !important; }
    }
  </style>
</head>
<body>

  <!-- Navigation -->
  <nav class="top-nav" role="navigation">
    <a href="index.html" class="nav-brand">
      <span class="nav-brand-icon">üå≤</span>
      <span>Access Nature</span>
    </a>
    
    <button class="menu-toggle" aria-label="Toggle navigation menu" aria-expanded="false" id="menuToggle">
      <span class="hamburger-icon"><span></span><span></span><span></span></span>
    </button>
    
    <div class="nav-menu" id="navMenu">
      <a href="index.html" class="nav-link active"><span class="nav-icon">üè†</span><span class="nav-label">Home</span></a>
      <a href="tracker.html" class="nav-link"><span class="nav-icon">üó∫Ô∏è</span><span class="nav-label">Track Trail</span></a>
      <button class="nav-link" id="browseTrailsNavBtn" type="button"><span class="nav-icon">üîç</span><span class="nav-label">Browse Trails</span></button>
      <a href="reports.html" class="nav-link"><span class="nav-icon">üìã</span><span class="nav-label">Reports</span></a>
      <a href="routes.html" class="nav-link"><span class="nav-icon">üìÇ</span><span class="nav-label">My Routes</span></a>
      <a href="accessibility.html" class="nav-link"><span class="nav-icon">‚ôø</span><span class="nav-label">Survey</span></a>
      <a href="profile.html" class="nav-link"><span class="nav-icon">üë§</span><span class="nav-label">Profile</span></a>
      <div class="nav-auth"><button id="authBtn" class="btn btn-primary">Sign In</button></div>
    </div>
  </nav>

  <!-- Hero Section -->
  <div class="hero-section">
    <div class="hero-content">
      <h1 class="hero-title">üå≤ Access Nature</h1>
      <p class="hero-subtitle">Making outdoor spaces accessible for everyone</p>
      <div id="authStatusBar" class="auth-status-landing">
        <div id="userInfo" class="user-info hidden">
          <span class="user-greeting">Welcome back, <span id="userEmail"></span>!</span>
          <button id="logoutBtn" class="btn" style="background: white; color: var(--primary-color);">Logout</button>
        </div>
        <div id="authPrompt" class="auth-prompt">
          <button id="showAuthBtn" class="btn" style="background: white; color: var(--primary-color);">Sign In</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Navigation -->
  <div class="main-navigation">
    <div class="nav-container">
      
      <!-- Accessibility Reports Card - FIXED icon -->
      <div class="nav-card" onclick="window.location.href='reports.html'">
        <div class="nav-card-icon">üìã</div>
        <h3 class="nav-card-title">Accessibility Reports</h3>
        <p class="nav-card-description">Report and view accessibility barriers in outdoor spaces and urban areas. Help build a more accessible world.</p>
        <div class="nav-card-footer">
          <span class="nav-card-badge">üó∫Ô∏è Interactive Map</span>
          <span class="nav-card-badge">üìä Real-time Data</span>
        </div>
      </div>

      <!-- Discover Trails Card -->
      <div class="nav-card discover-card">
        <div class="nav-card-icon">üîç</div>
        <h2>Discover Accessible Trails</h2>
        <p>Browse community-contributed accessible trail guides with detailed accessibility information, photos, and reviews.</p>
        <div class="nav-card-features">
          <span class="feature-tag">‚ôø Wheelchair Access</span>
          <span class="feature-tag">üì∑ Photos & Notes</span>
          <span class="feature-tag">‚≠ê Community Reviews</span>
          <span class="feature-tag">üó∫Ô∏è Interactive Maps</span>
        </div>
        <button class="btn btn-primary btn-lg" id="browseTrailsBtn">üîç Browse Trail Guides</button>
        <div class="quick-search">
          <input type="text" id="quickSearch" placeholder="Quick search trails..." maxlength="50" class="form-input">
          <button id="quickSearchBtn" class="btn btn-primary">Search</button>
        </div>
      </div>

      <!-- Track New Trail Card -->
      <div class="nav-card track-card">
        <div class="nav-card-icon">üìç</div>
        <h2>Map a New Trail</h2>
        <p>Use GPS tracking to document new accessible routes. Record accessibility features, take photos, and create trail guides for the community.</p>
        <div class="nav-card-features">
          <span class="feature-tag">üì± GPS Tracking</span>
          <span class="feature-tag">üìù Accessibility Survey</span>
          <span class="feature-tag">üì∑ Photo Documentation</span>
          <span class="feature-tag">‚òÅÔ∏è Cloud Sync</span>
        </div>
        <button class="btn btn-success btn-lg" id="startTrackingBtn">üìç Start Tracking</button>
        <div class="tracker-stats">
          <div class="stat-item"><span class="stat-number" id="totalRoutes">0</span><span class="stat-label">Routes Mapped</span></div>
          <div class="stat-item"><span class="stat-number" id="totalDistance">0</span><span class="stat-label">km Documented</span></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Community Stats -->
  <div class="community-section">
    <div class="community-container">
      <h3>üåç Community Impact</h3>
      <div class="community-stats">
        <div class="community-stat"><span class="stat-big" id="publicGuides">0</span><span class="stat-desc">Public Trail Guides</span></div>
        <div class="community-stat"><span class="stat-big" id="totalKm">0</span><span class="stat-desc">Kilometers Mapped</span></div>
        <div class="community-stat"><span class="stat-big" id="accessibleTrails">0</span><span class="stat-desc">Wheelchair Accessible</span></div>
        <div class="community-stat"><span class="stat-big" id="totalUsers">0</span><span class="stat-desc">Contributors</span></div>
      </div>
    </div>
  </div>

  <!-- Featured Trails -->
  <div class="featured-section">
    <div class="featured-container">
      <h3>‚≠ê Featured Accessible Trails</h3>
      <div id="featuredTrails" class="featured-grid"></div>
      <button class="btn btn-primary load-more-btn" id="loadMoreFeaturedBtn">Load More Trails</button>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer-section">
    <div class="footer-container">
      <div class="footer-content">
        <div class="footer-brand"><h4>üå≤ Access Nature</h4><p>Making outdoor spaces accessible for everyone</p></div>
        <div class="footer-links">
          <a href="#" id="aboutLink">About</a>
          <a href="#" id="privacyLink">Privacy</a>
          <a href="#" id="contactLink">Contact</a>
          <a href="#" id="helpLink">Help</a>
        </div>
      </div>
      <div class="footer-bottom"><p>¬© 2024 Access Nature. Making nature accessible for everyone.</p></div>
    </div>
  </footer>

  <!-- Trail Browser Modal -->
  <div id="trailBrowserModal" class="hidden">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">üîç Browse Trail Guides</h2>
        <button class="modal-close" id="closeTrailBrowserBtn">√ó</button>
      </div>
      <div class="modal-body">
        <div class="form-group"><input type="text" id="trailSearch" class="form-input" placeholder="Search trails..."></div>
        <div class="filter-grid">
          <div class="form-group"><select id="filterAccessibility" class="form-select"><option value="">All Accessibility</option><option value="wheelchair">Wheelchair</option><option value="limited">Limited Mobility</option></select></div>
          <div class="form-group"><select id="filterDifficulty" class="form-select"><option value="">All Difficulty</option><option value="easy">Easy</option><option value="moderate">Moderate</option><option value="hard">Hard</option></select></div>
          <div class="form-group"><button id="applyFiltersBtn" class="btn btn-primary" style="width: 100%;">Apply Filters</button></div>
        </div>
        <div id="trailResults"></div>
        <button id="loadMoreResultsBtn" class="btn btn-secondary" style="width: 100%; margin-top: 1rem;">Load More</button>
      </div>
    </div>
  </div>

  <!-- Toast & Loading -->
  <div id="toastContainer" class="toast-container"></div>
  <div id="loadingOverlay" class="loading-overlay hidden"><div class="spinner"></div></div>

  <!-- Scripts -->
  <script type="module" src="src/firebase-setup.js"></script>
  <script src="universal-navigation.js"></script>
  <script src="auth-status-handler.js"></script>

  <script type="module">
    import toast from './src/helpers/toasts.js';
    import modal from './src/helpers/modals.js';
    import { showLoading, hideLoading } from './src/helpers/loading.js';
    window.toast = toast;
    window.modal = modal;
    window.showLoading = showLoading;
    window.hideLoading = hideLoading;
  </script>

  <script type="module" src="src/landing.js"></script>
  <script type="module" src="src/features/auth.js"></script>

  <!-- Page Functionality -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      console.log('üè† Index page initializing...');

      const trailBrowserModal = document.getElementById('trailBrowserModal');
      const menuToggle = document.getElementById('menuToggle');
      const navMenu = document.getElementById('navMenu');

      // Trail Browser Modal
      function openTrailBrowser() {
        if (trailBrowserModal) trailBrowserModal.classList.remove('hidden');
      }

      function closeTrailBrowser() {
        if (trailBrowserModal) trailBrowserModal.classList.add('hidden');
      }

      window.openTrailBrowser = openTrailBrowser;
      window.closeTrailBrowser = closeTrailBrowser;

      // Event Listeners
      document.getElementById('browseTrailsBtn')?.addEventListener('click', openTrailBrowser);
      document.getElementById('browseTrailsNavBtn')?.addEventListener('click', () => {
        if (menuToggle && navMenu?.classList.contains('active')) {
          menuToggle.classList.remove('active');
          navMenu.classList.remove('active');
          menuToggle.setAttribute('aria-expanded', 'false');
          document.body.classList.remove('menu-open');
        }
        setTimeout(openTrailBrowser, 100);
      });
      document.getElementById('closeTrailBrowserBtn')?.addEventListener('click', closeTrailBrowser);
      trailBrowserModal?.addEventListener('click', (e) => { if (e.target === trailBrowserModal) closeTrailBrowser(); });
      document.getElementById('startTrackingBtn')?.addEventListener('click', () => { window.location.href = 'tracker.html'; });

      document.getElementById('quickSearchBtn')?.addEventListener('click', () => {
        const query = document.getElementById('quickSearch')?.value;
        if (query?.trim()) {
          openTrailBrowser();
          const trailSearch = document.getElementById('trailSearch');
          if (trailSearch) {
            trailSearch.value = query;
            if (window.LandingPageController?.searchTrails) setTimeout(() => window.LandingPageController.searchTrails(), 100);
          }
        } else if (window.toast) window.toast.warning('Please enter a search term');
      });

      document.getElementById('applyFiltersBtn')?.addEventListener('click', () => { window.LandingPageController?.applyFilters?.(); });
      document.getElementById('loadMoreResultsBtn')?.addEventListener('click', () => { window.LandingPageController?.loadMoreResults?.(); });
      document.getElementById('loadMoreFeaturedBtn')?.addEventListener('click', () => { window.LandingPageController?.loadMoreFeatured?.() || window.toast?.info('Loading trail guides...'); });

      // Footer
      document.getElementById('aboutLink')?.addEventListener('click', (e) => { e.preventDefault(); window.modal?.alert('Access Nature is a community-driven platform dedicated to making outdoor spaces accessible for everyone.', 'About Access Nature'); });
      document.getElementById('privacyLink')?.addEventListener('click', (e) => { e.preventDefault(); window.modal?.alert('Your privacy is important to us. We only collect data necessary to provide our services.', 'Privacy Policy'); });
      document.getElementById('contactLink')?.addEventListener('click', (e) => { e.preventDefault(); window.modal?.alert('Email: support@accessnature.org', 'Contact Us'); });
      document.getElementById('helpLink')?.addEventListener('click', (e) => { e.preventDefault(); window.modal?.alert('Need help? Contact support at support@accessnature.org', 'Help & Support'); });

      // Escape key
      document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && trailBrowserModal && !trailBrowserModal.classList.contains('hidden')) closeTrailBrowser(); });

      // Hamburger Menu
      if (menuToggle && navMenu) {
        menuToggle.addEventListener('click', (e) => {
          e.preventDefault();
          const isExpanded = menuToggle.getAttribute('aria-expanded') === 'true';
          menuToggle.setAttribute('aria-expanded', !isExpanded);
          menuToggle.classList.toggle('active');
          navMenu.classList.toggle('active');
          document.body.classList.toggle('menu-open');
        });

        navMenu.querySelectorAll('a.nav-link').forEach(link => {
          link.addEventListener('click', () => {
            menuToggle.classList.remove('active');
            navMenu.classList.remove('active');
            menuToggle.setAttribute('aria-expanded', 'false');
            document.body.classList.remove('menu-open');
          });
        });
      }

      console.log('‚úÖ Index page initialized');
    });
  </script>
</body>
</html>