<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Accessibility Reports - Access Nature</title>
  <meta name="description" content="View and report accessibility barriers in outdoor spaces and urban areas">
  
  <!-- Unified Design System -->
  <link rel="stylesheet" href="access-nature-design-system.css">
  
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
  
  <style>
    /* Page-specific styles */
    body {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
    }

    .page-container {
      max-width: var(--max-width-2xl);
      margin: 0 auto;
      padding: var(--space-xl);
    }

    .page-header {
      background: white;
      border-radius: var(--radius-xl);
      padding: var(--space-2xl);
      margin-bottom: var(--space-xl);
      box-shadow: var(--shadow-lg);
    }

    .page-header h1 {
      font-size: var(--font-size-4xl);
      color: var(--text-color);
      margin-bottom: var(--space-sm);
    }

    .page-header p {
      color: var(--text-secondary);
      font-size: var(--font-size-lg);
      margin: 0;
    }

    /* CRITICAL: Report Modal Fix */
    #reportDetailModal {
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      right: 0 !important;
      bottom: 0 !important;
      z-index: 10000 !important; /* Higher than everything */
      background: rgba(0, 0, 0, 0.5) !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      padding: var(--space-md);
    }

    #reportDetailModal.hidden {
      display: none !important;
    }

    #reportDetailModal .modal-content {
      background: white;
      border-radius: var(--radius-xl);
      max-width: 800px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      z-index: 10001 !important;
    }

    /* Report Timeline Cards */
    .report-card {
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .report-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-xl);
    }

    /* Force modal to be visible */
.modal-backdrop,
[id^="modal-"],
[id*="modal"],
[class*="modal"] {
  opacity: 1 !important;
  visibility: visible !important;
}

/* Ensure high z-index above everything */
.modal-backdrop,
[id^="modal-"] {
  z-index: 999999 !important;
  position: fixed !important;
}

/* Lower map z-index */
#reportMap,
.map-section,
.leaflet-container {
  z-index: 1 !important;
}

/* Ensure modal content is visible */
.modal-content,
[class*="modal-content"] {
  opacity: 1 !important;
  visibility: visible !important;
  z-index: 1000000 !important;
}

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--space-lg);
      margin-bottom: var(--space-xl);
    }

    .stat-card {
      background: white;
      border-radius: var(--radius-lg);
      padding: var(--space-xl);
      box-shadow: var(--shadow-md);
      text-align: center;
    }

    .stat-value {
      font-size: var(--font-size-4xl);
      font-weight: 700;
      color: var(--primary-color);
      margin-bottom: var(--space-sm);
    }

    .stat-label {
      color: var(--text-secondary);
      font-size: var(--font-size-sm);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Filters Section */
    .filters-section {
      background: white;
      border-radius: var(--radius-lg);
      padding: var(--space-xl);
      margin-bottom: var(--space-xl);
      box-shadow: var(--shadow-md);
    }

    .filters-title {
      font-size: var(--font-size-xl);
      font-weight: 600;
      margin-bottom: var(--space-lg);
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }

    .filters-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--space-lg);
      margin-bottom: var(--space-lg);
    }

    .filter-actions {
      display: flex;
      gap: var(--space-md);
      flex-wrap: wrap;
    }

    /* Map Section */
    .map-section {
      background: white;
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      box-shadow: var(--shadow-md);
      margin-bottom: var(--space-xl);
    }

    .map-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-lg);
      flex-wrap: wrap;
      gap: var(--space-md);
    }

    .map-header h2 {
      font-size: var(--font-size-2xl);
      margin: 0;
    }

    .map-controls {
      display: flex;
      gap: var(--space-sm);
    }

    .map-control-btn {
      width: 44px;
      height: 44px;
      background: var(--bg-secondary);
      border: none;
      border-radius: var(--radius-md);
      cursor: pointer;
      font-size: var(--font-size-xl);
      transition: all var(--transition-fast);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .map-control-btn:hover {
      background: var(--primary-color);
      color: white;
      transform: translateY(-2px);
    }

    #reportMap {
      height: 500px;
      border-radius: var(--radius-md);
      width: 100%;
      max-width: 100%;
    }

    #reportMap.fullscreen {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: var(--z-modal);
      height: 100vh !important;
      width: 100vw !important;
      max-width: none;
      border-radius: 0;
      margin: 0;
    }

    /* Timeline Section */
    .timeline-section {
      background: white;
      border-radius: var(--radius-lg);
      padding: var(--space-xl);
      box-shadow: var(--shadow-md);
    }

    .timeline-section h2 {
      font-size: var(--font-size-2xl);
      margin-bottom: var(--space-lg);
    }

    /* Floating Action Button */
    .report-fab {
      position: fixed;
      bottom: var(--space-2xl);
      right: var(--space-2xl);
      width: 64px;
      height: 64px;
      background: var(--error-color);
      color: white;
      border: none;
      border-radius: var(--radius-full);
      font-size: 2rem;
      cursor: pointer;
      box-shadow: var(--shadow-xl);
      transition: all var(--transition-base);
      z-index: var(--z-fixed);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .report-fab:hover {
      transform: scale(1.1);
      box-shadow: 0 8px 20px rgba(239, 68, 68, 0.4);
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
      .page-container {
        padding: var(--space-md);
      }

      .page-header {
        padding: var(--space-lg);
      }

      .page-header h1 {
        font-size: var(--font-size-3xl);
      }

      .filters-grid {
        grid-template-columns: 1fr;
      }

      .filter-actions {
        flex-direction: column;
      }

      .filter-actions .btn {
        width: 100%;
      }

      #reportMap {
        height: 400px;
      }

      .report-fab {
        bottom: var(--space-lg);
        right: var(--space-lg);
        width: 56px;
        height: 56px;
      }
    }
  </style>
</head>
<body>
  <!-- Loading Overlay -->
  <div id="loadingOverlay" class="loading-overlay hidden">
    <div class="spinner"></div>
  </div>

  <!-- Navigation -->
  <nav class="top-nav" role="navigation">
    <a href="index.html" class="nav-brand">
      <span class="nav-brand-icon">üå≤</span>
      <span>Access Nature</span>
    </a>
    
    <button class="menu-toggle" 
            aria-label="Toggle navigation menu"
            aria-expanded="false"
            id="menuToggle">
      <span class="hamburger-icon">
        <span></span>
        <span></span>
        <span></span>
      </span>
    </button>
    
    <div class="nav-menu" id="navMenu">
      <a href="index.html" class="nav-link">
        <span class="nav-icon">üè†</span>
        <span class="nav-label">Home</span>
      </a>
      <a href="tracker.html" class="nav-link">
        <span class="nav-icon">üó∫Ô∏è</span>
        <span class="nav-label">Track Trail</span>
      </a>
      <a href="reports.html" class="nav-link active">
        <span class="nav-icon">‚ö†Ô∏è</span>
        <span class="nav-label">Reports</span>
      </a>
      <a href="routes.html" class="nav-link">
        <span class="nav-icon">üìÇ</span>
        <span class="nav-label">My Routes</span>
      </a>
      <a href="accessibility.html" class="nav-link">
        <span class="nav-icon">‚ôø</span>
        <span class="nav-label">Survey</span>
      </a>
      <a href="profile.html" class="nav-link">
        <span class="nav-icon">üë§</span>
        <span class="nav-label">Profile</span>
      </a>
      
      <div class="nav-auth">
        <button id="authBtn" class="btn btn-primary">Sign In</button>
      </div>
    </div>
  </nav>

  <div class="page-container">
    <!-- Page Header -->
    <div class="page-header">
      <h1>‚ö†Ô∏è Accessibility Reports</h1>
      <p>Report and view accessibility barriers in outdoor spaces and urban areas</p>
    </div>

    <!-- Stats Section -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value" id="totalReports">0</div>
        <div class="stat-label">Total Reports</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="newReports">0</div>
        <div class="stat-label">New</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="resolvedReports">0</div>
        <div class="stat-label">Resolved</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="yourLocation">Detecting...</div>
        <div class="stat-label">Your Location</div>
      </div>
    </div>

    <!-- Filters Section -->
    <div class="filters-section">
      <h3 class="filters-title">
        <span>üîç</span>
        <span>Filter Reports</span>
      </h3>
      <div class="filters-grid">
        <div class="form-group">
          <label for="countryFilter" class="form-label">Country</label>
          <select id="countryFilter" class="form-select">
            <option value="">All Countries</option>
          </select>
        </div>
        <div class="form-group">
          <label for="cityFilter" class="form-label">City</label>
          <select id="cityFilter" class="form-select">
            <option value="">All Cities</option>
          </select>
        </div>
        <div class="form-group">
          <label for="statusFilter" class="form-label">Status</label>
          <select id="statusFilter" class="form-select">
            <option value="">All Statuses</option>
            <option value="new">New</option>
            <option value="acknowledged">Acknowledged</option>
            <option value="in_progress">In Progress</option>
            <option value="resolved">Resolved</option>
          </select>
        </div>
        <div class="form-group">
          <label for="severityFilter" class="form-label">Severity</label>
          <select id="severityFilter" class="form-select">
            <option value="">All Severities</option>
            <option value="critical">Critical</option>
            <option value="high">High</option>
            <option value="medium">Medium</option>
            <option value="low">Low</option>
          </select>
        </div>
      </div>
      <div class="filter-actions">
        <button class="btn btn-primary" id="applyFiltersBtn">
          üîç Apply Filters
        </button>
        <button class="btn btn-secondary" id="resetFiltersBtn">
          üîÑ Reset
        </button>
        <button class="btn btn-secondary" id="useMyLocationBtn">
          üìç Use My Location
        </button>
      </div>
    </div>

    <!-- Map Section -->
    <div class="map-section">
      <div class="map-header">
        <h2>üó∫Ô∏è Report Map</h2>
        <div class="map-controls">
          <button class="map-control-btn" id="centerMapBtn" title="Center on my location">
            üìç
          </button>
          <button class="map-control-btn" id="fullscreenBtn" title="Toggle fullscreen">
            ‚õ∂
          </button>
        </div>
      </div>
      <div id="reportMap"></div>
    </div>

    <!-- Timeline Section -->
    <div class="timeline-section">
      <h2>üìã Recent Reports</h2>
      <div id="reportTimeline"></div>
    </div>
  </div>

  <!-- Report FAB -->
  <button class="report-fab" id="reportFabBtn" title="Report an issue">
    ‚ö†Ô∏è
  </button>

  <!-- Report Detail Modal -->
  <div id="reportDetailModal" class="hidden">
    <div class="modal-content">
      <!-- Dynamically populated by access-report-main.js -->
    </div>
  </div>

  <!-- Firebase SDK -->
  <script type="module" src="src/firebase-setup.js"></script>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

  <!-- Universal Navigation & Auth -->
  <script src="universal-navigation.js"></script>
  <script src="auth-status-handler.js"></script>

  <!-- App Scripts -->

  <script type="module" src="src/helpers/toasts.js"></script>
  <script type="module" src="src/helpers/modals.js"></script>
  <script type="module" src="reports-page.js"></script>

  <!-- Report Modal Fix Script -->
  <script>
    // Ensure modal works correctly
    document.addEventListener('DOMContentLoaded', () => {
      console.log('üîß Setting up report modal handlers...');
      
      // Close modal when clicking backdrop
      document.addEventListener('click', (e) => {
        const modal = document.getElementById('reportDetailModal');
        if (modal && e.target === modal && !modal.classList.contains('hidden')) {
          console.log('üö™ Closing modal via backdrop click');
          modal.classList.add('hidden');
        }
      });
      
      // Close modal on escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          const modal = document.getElementById('reportDetailModal');
          if (modal && !modal.classList.contains('hidden')) {
            console.log('üö™ Closing modal via Escape key');
            modal.classList.add('hidden');
          }
        }
      });
      
      // Prevent click propagation on modal content
      const modal = document.getElementById('reportDetailModal');
      if (modal) {
        modal.addEventListener('click', (e) => {
          const content = modal.querySelector('.modal-content');
          if (content && content.contains(e.target)) {
            e.stopPropagation();
          }
        });
      }
      
      console.log('‚úÖ Report modal handlers ready');
    });
  </script>
</body>
</html>